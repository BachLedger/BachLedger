# BachLedger 4-validator multi-node deployment
#
# Validator keys (Hardhat test accounts - DO NOT use in production):
#   #0 ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 -> 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
#   #1 59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d -> 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
#   #2 5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a -> 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
#   #3 7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6 -> 0x90F79bf6EB2c4f870365E785982E1f101E93b906

x-common-args: &common-args
  VALIDATORS: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266,0x70997970C51812dc3A010C7d01b50e0d17dc79C8,0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC,0x90F79bf6EB2c4f870365E785982E1f101E93b906"

services:
  validator-1:
    build: .
    container_name: bach-validator-1
    command:
      - --datadir=/data
      - --chain-id=1337
      - --p2p-addr=0.0.0.0:30303
      - --rpc-addr=0.0.0.0:8545
      - --validator-key=ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
      - --validators=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266,0x70997970C51812dc3A010C7d01b50e0d17dc79C8,0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC,0x90F79bf6EB2c4f870365E785982E1f101E93b906
      - --log-level=debug
    ports:
      - "18545:8545"
      - "30303:30303"
    volumes:
      - v1-data:/data
    networks:
      bachnet:
        ipv4_address: 172.25.0.11

  validator-2:
    build: .
    container_name: bach-validator-2
    command:
      - --datadir=/data
      - --chain-id=1337
      - --p2p-addr=0.0.0.0:30303
      - --bootnodes=172.25.0.11:30303
      - --rpc-addr=0.0.0.0:8545
      - --validator-key=59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d
      - --validators=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266,0x70997970C51812dc3A010C7d01b50e0d17dc79C8,0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC,0x90F79bf6EB2c4f870365E785982E1f101E93b906
      - --log-level=debug
    ports:
      - "18546:8545"
    volumes:
      - v2-data:/data
    networks:
      bachnet:
        ipv4_address: 172.25.0.12
    depends_on:
      - validator-1

  validator-3:
    build: .
    container_name: bach-validator-3
    command:
      - --datadir=/data
      - --chain-id=1337
      - --p2p-addr=0.0.0.0:30303
      - --bootnodes=172.25.0.11:30303
      - --rpc-addr=0.0.0.0:8545
      - --validator-key=5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a
      - --validators=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266,0x70997970C51812dc3A010C7d01b50e0d17dc79C8,0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC,0x90F79bf6EB2c4f870365E785982E1f101E93b906
      - --log-level=debug
    ports:
      - "18547:8545"
    volumes:
      - v3-data:/data
    networks:
      bachnet:
        ipv4_address: 172.25.0.13
    depends_on:
      - validator-1

  validator-4:
    build: .
    container_name: bach-validator-4
    command:
      - --datadir=/data
      - --chain-id=1337
      - --p2p-addr=0.0.0.0:30303
      - --bootnodes=172.25.0.11:30303
      - --rpc-addr=0.0.0.0:8545
      - --validator-key=7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6
      - --validators=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266,0x70997970C51812dc3A010C7d01b50e0d17dc79C8,0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC,0x90F79bf6EB2c4f870365E785982E1f101E93b906
      - --log-level=debug
    ports:
      - "18548:8545"
    volumes:
      - v4-data:/data
    networks:
      bachnet:
        ipv4_address: 172.25.0.14
    depends_on:
      - validator-1

volumes:
  v1-data:
  v2-data:
  v3-data:
  v4-data:

networks:
  bachnet:
    driver: bridge
    ipam:
      config:
        - subnet: 172.25.0.0/16
